import { fromEventPattern } from 'rxjs';
export function createMVCEventObservable(array) {
    const eventNames = ['insert_at', 'remove_at', 'set_at'];
    return fromEventPattern((handler) => eventNames.map(evName => array.addListener(evName, (index, previous) => handler.apply(array, [{ 'newArr': array.getArray(), evName, index, previous }]))), (_handler, evListeners) => evListeners.forEach(evListener => evListener.remove()));
}
export class MvcArrayMock {
    constructor() {
        this.vals = [];
        this.listeners = {
            'remove_at': [],
            'insert_at': [],
            'set_at': [],
        };
    }
    clear() {
        for (let i = this.vals.length - 1; i >= 0; i--) {
            this.removeAt(i);
        }
    }
    getArray() {
        return [...this.vals];
    }
    getAt(i) {
        return this.vals[i];
    }
    getLength() {
        return this.vals.length;
    }
    insertAt(i, elem) {
        this.vals.splice(i, 0, elem);
        this.listeners.insert_at.map(listener => listener(i));
    }
    pop() {
        const deleted = this.vals.pop();
        this.listeners.remove_at.map(listener => listener(this.vals.length, deleted));
        return deleted;
    }
    push(elem) {
        this.vals.push(elem);
        this.listeners.insert_at.map(listener => listener(this.vals.length - 1));
        return this.vals.length;
    }
    removeAt(i) {
        const deleted = this.vals.splice(i, 1)[0];
        this.listeners.remove_at.map(listener => listener(i, deleted));
        return deleted;
    }
    setAt(i, elem) {
        const deleted = this.vals[i];
        this.vals[i] = elem;
        this.listeners.set_at.map(listener => listener(i, deleted));
    }
    forEach(callback) {
        this.vals.forEach(callback);
    }
    addListener(eventName, handler) {
        const listenerArr = this.listeners[eventName];
        listenerArr.push(handler);
        return {
            remove: () => {
                listenerArr.splice(listenerArr.indexOf(handler), 1);
            },
        };
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibXZjYXJyYXktdXRpbHMuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYWdtL2NvcmUvIiwic291cmNlcyI6WyJ1dGlscy9tdmNhcnJheS11dGlscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsZ0JBQWdCLEVBQWMsTUFBTSxNQUFNLENBQUM7QUFHcEQsTUFBTSxVQUFVLHdCQUF3QixDQUFJLEtBQWtCO0lBQzVELE1BQU0sVUFBVSxHQUFHLENBQUMsV0FBVyxFQUFFLFdBQVcsRUFBRSxRQUFRLENBQUMsQ0FBQztJQUN4RCxPQUFPLGdCQUFnQixDQUNyQixDQUFDLE9BQWlCLEVBQUUsRUFBRSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLE1BQU0sRUFDdEUsQ0FBQyxLQUFhLEVBQUUsUUFBWSxFQUFFLEVBQUUsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxDQUFFLEVBQUMsUUFBUSxFQUFFLEtBQUssQ0FBQyxRQUFRLEVBQUUsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBZ0IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUNsSSxDQUFDLFFBQWtCLEVBQUUsV0FBZ0MsRUFBRSxFQUFFLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUM7QUFDdEgsQ0FBQztBQVdELE1BQU0sT0FBTyxZQUFZO0lBQXpCO1FBQ1UsU0FBSSxHQUFRLEVBQUUsQ0FBQztRQUNmLGNBQVMsR0FLYjtZQUNGLFdBQVcsRUFBRSxFQUFnQjtZQUM3QixXQUFXLEVBQUUsRUFBZ0I7WUFDN0IsUUFBUSxFQUFFLEVBQWdCO1NBQzNCLENBQUM7SUFtREosQ0FBQztJQWxEQyxLQUFLO1FBQ0gsS0FBSyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxD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Q0FBQyxDQUFDO1lBQ3hELENBQUM7U0FDSixDQUFDO0lBQ0osQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZnJvbUV2ZW50UGF0dGVybiwgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgTWFwc0V2ZW50TGlzdGVuZXIsIE1WQ0FycmF5IH0gZnJvbSAnLi4vc2VydmljZXMvZ29vZ2xlLW1hcHMtdHlwZXMnO1xuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTVZDRXZlbnRPYnNlcnZhYmxlPFQ+KGFycmF5OiBNVkNBcnJheTxUPik6IE9ic2VydmFibGU8TVZDRXZlbnQ8VD4+e1xuICBjb25zdCBldmVudE5hbWVzID0gWydpbnNlcnRfYXQnLCAncmVtb3ZlX2F0JywgJ3NldF9hdCddO1xuICByZXR1cm4gZnJvbUV2ZW50UGF0dGVybihcbiAgICAoaGFuZGxlcjogRnVuY3Rpb24pID0+IGV2ZW50TmFtZXMubWFwKGV2TmFtZSA9PiBhcnJheS5hZGRMaXN0ZW5lcihldk5hbWUsXG4gICAgICAoaW5kZXg6IG51bWJlciwgcHJldmlvdXM/OiBUKSA9PiBoYW5kbGVyLmFwcGx5KGFycmF5LCBbIHsnbmV3QXJyJzogYXJyYXkuZ2V0QXJyYXkoKSwgZXZOYW1lLCBpbmRleCwgcHJldmlvdXN9IGFzIE1WQ0V2ZW50PFQ+XSkpKSxcbiAgICAoX2hhbmRsZXI6IEZ1bmN0aW9uLCBldkxpc3RlbmVyczogTWFwc0V2ZW50TGlzdGVuZXJbXSkgPT4gZXZMaXN0ZW5lcnMuZm9yRWFjaChldkxpc3RlbmVyID0+IGV2TGlzdGVuZXIucmVtb3ZlKCkpKTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBNVkNFdmVudDxUPiB7XG4gIG5ld0FycjogVFtdO1xuICBldk5hbWU6IE12Y0V2ZW50VHlwZTtcbiAgaW5kZXg6IG51bWJlcjtcbiAgcHJldmlvdXM/OiBUO1xufVxuXG5leHBvcnQgdHlwZSBNdmNFdmVudFR5cGUgPSAnaW5zZXJ0X2F0JyB8ICdyZW1vdmVfYXQnIHwgJ3NldF9hdCc7XG5cbmV4cG9ydCBjbGFzcyBNdmNBcnJheU1vY2s8VD4gaW1wbGVtZW50cyBNVkNBcnJheTxUPiB7XG4gIHByaXZhdGUgdmFsczogVFtdID0gW107XG4gIHByaXZhdGUgbGlzdGVuZXJzOiB7XG4gICAgJ3JlbW92ZV9hdCc6IEZ1bmN0aW9uW107XG4gICAgJ2luc2VydF9hdCc6IEZ1bmN0aW9uW107XG4gICAgJ3NldF9hdCc6IEZ1bmN0aW9uW107XG4gICAgW2tleTogc3RyaW5nXTogRnVuY3Rpb25bXTtcbiAgfSA9IHtcbiAgICAncmVtb3ZlX2F0JzogW10gYXMgRnVuY3Rpb25bXSxcbiAgICAnaW5zZXJ0X2F0JzogW10gYXMgRnVuY3Rpb25bXSxcbiAgICAnc2V0X2F0JzogW10gYXMgRnVuY3Rpb25bXSxcbiAgfTtcbiAgY2xlYXIoKTogdm9pZCB7XG4gICAgZm9yIChsZXQgaSA9IHRoaXMudmFscy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICB0aGlzLnJlbW92ZUF0KGkpO1xuICAgIH1cbiAgfVxuICBnZXRBcnJheSgpOiBUW10ge1xuICAgIHJldHVybiBbLi4udGhpcy52YWxzXTtcbiAgfVxuICBnZXRBdChpOiBudW1iZXIpOiBUIHtcbiAgICByZXR1cm4gdGhpcy52YWxzW2ldO1xuICB9XG4gIGdldExlbmd0aCgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLnZhbHMubGVuZ3RoO1xuICB9XG4gIGluc2VydEF0KGk6IG51bWJlciwgZWxlbTogVCk6IHZvaWQge1xuICAgIHRoaXMudmFscy5zcGxpY2UoaSwgMCwgZWxlbSk7XG4gICAgdGhpcy5saXN0ZW5lcnMuaW5zZXJ0X2F0Lm1hcChsaXN0ZW5lciA9PiBsaXN0ZW5lcihpKSk7XG4gIH1cbiAgcG9wKCk6IFQge1xuICAgIGNvbnN0IGRlbGV0ZWQgPSB0aGlzLnZhbHMucG9wKCk7XG4gICAgdGhpcy5saXN0ZW5lcnMucmVtb3ZlX2F0Lm1hcChsaXN0ZW5lciA9PiBsaXN0ZW5lcih0aGlzLnZhbHMubGVuZ3RoLCBkZWxldGVkKSk7XG4gICAgcmV0dXJuIGRlbGV0ZWQ7XG4gIH1cbiAgcHVzaChlbGVtOiBUKTogbnVtYmVyIHtcbiAgICB0aGlzLnZhbHMucHVzaChlbGVtKTtcbiAgICB0aGlzLmxpc3RlbmVycy5pbnNlcnRfYXQubWFwKGxpc3RlbmVyID0+IGxpc3RlbmVyKHRoaXMudmFscy5sZW5ndGggLSAxKSk7XG4gICAgcmV0dXJuIHRoaXMudmFscy5sZW5ndGg7XG4gIH1cbiAgcmVtb3ZlQXQoaTogbnVtYmVyKTogVCB7XG4gICAgY29uc3QgZGVsZXRlZCA9IHRoaXMudmFscy5zcGxpY2UoaSwgMSlbMF07XG4gICAgdGhpcy5saXN0ZW5lcnMucmVtb3ZlX2F0Lm1hcChsaXN0ZW5lciA9PiBsaXN0ZW5lcihpLCBkZWxldGVkKSk7XG4gICAgcmV0dXJuIGRlbGV0ZWQ7XG4gIH1cbiAgc2V0QXQoaTogbnVtYmVyLCBlbGVtOiBUKTogdm9pZCB7XG4gICAgY29uc3QgZGVsZXRlZCA9IHRoaXMudmFsc1tpXTtcbiAgICB0aGlzLnZhbHNbaV0gPSBlbGVtO1xuICAgIHRoaXMubGlzdGVuZXJzLnNldF9hdC5tYXAobGlzdGVuZXIgPT4gbGlzdGVuZXIoaSwgZGVsZXRlZCkpO1xuICB9XG4gIGZvckVhY2goY2FsbGJhY2s6IChlbGVtOiBULCBpOiBudW1iZXIpID0+IHZvaWQpOiB2b2lkIHtcbiAgICB0aGlzLnZhbHMuZm9yRWFjaChjYWxsYmFjayk7XG4gIH1cbiAgYWRkTGlzdGVuZXIoZXZlbnROYW1lOiBzdHJpbmcsIGhhbmRsZXI6IEZ1bmN0aW9uKTogTWFwc0V2ZW50TGlzdGVuZXIge1xuICAgIGNvbnN0IGxpc3RlbmVyQXJyID0gdGhpcy5saXN0ZW5lcnNbZXZlbnROYW1lXTtcbiAgICBsaXN0ZW5lckFyci5wdXNoKGhhbmRsZXIpO1xuICAgIHJldHVybiB7XG4gICAgICAgIHJlbW92ZTogKCkgPT4ge1xuICAgICAgICAgICAgbGlzdGVuZXJBcnIuc3BsaWNlKGxpc3RlbmVyQXJyLmluZGV4T2YoaGFuZGxlciksIDEpO1xuICAgICAgICB9LFxuICAgIH07XG4gIH1cbn1cbiJdfQ==